From: VirtualBrowser Team <virtual.browser.2020@gmail.com>
Subject: [PATCH] Navigator Fingerprint Spoofing
---
This patch modifies Navigator properties to prevent fingerprinting through
userAgent, platform, hardwareConcurrency, deviceMemory, etc.

diff --git a/third_party/blink/renderer/core/frame/navigator.cc b/third_party/blink/renderer/core/frame/navigator.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/frame/navigator.cc
+++ b/third_party/blink/renderer/core/frame/navigator.cc
@@ -33,6 +33,7 @@
 #include "third_party/blink/renderer/core/frame/web_local_frame_impl.h"
 #include "third_party/blink/renderer/core/loader/frame_loader.h"
 #include "third_party/blink/renderer/platform/wtf/text/string_builder.h"
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 
 namespace blink {
 
@@ -85,6 +86,12 @@ String Navigator::userAgent() const {
   if (GetFrame()->GetPage()->GetSettings().GetWebSecurityEnabled() &&
       !GetFrame()->GetSecurityContext()->GetSecurityOrigin()->IsOpaque()) {
     result = UserAgentOverride::OverrideUserAgent(result);
+
+    // VirtualBrowser: Override userAgent with fingerprint data
+    if (FingerprintGenerator::IsEnabled()) {
+      String custom_ua = FingerprintGenerator::GetUserAgent();
+      if (!custom_ua.IsEmpty())
+        result = custom_ua;
+    }
   }
   return result;
 }
@@ -95,6 +102,11 @@ String Navigator::platform() const {
       GetFrame()->Loader().UserAgentFromMetadata(),
       GetFrame()->GetPage()->GetUAChromiumPlatform());
 
+  // VirtualBrowser: Override platform with fingerprint data
+  if (FingerprintGenerator::IsEnabled()) {
+    String custom_platform = FingerprintGenerator::GetPlatform();
+    if (!custom_platform.IsEmpty())
+      return custom_platform;
+  }
+
   return platform;
 }
 
@@ -115,6 +127,12 @@ String Navigator::vendor() const {
   String vendor =
       GetFrame()->Loader().UserAgentMetadata().brand_version_list[0].brand;
   DCHECK(!vendor.IsEmpty());
+
+  // VirtualBrowser: Override vendor with fingerprint data
+  if (FingerprintGenerator::IsEnabled()) {
+    String custom_vendor = FingerprintGenerator::GetVendor();
+    if (!custom_vendor.IsEmpty())
+      return custom_vendor;
+  }
+
   return vendor;
 }
 
diff --git a/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc b/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
+++ b/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
@@ -4,6 +4,7 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_concurrent_hardware.h"
 
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 #include "base/system/sys_info.h"
 
 namespace blink {
@@ -12,6 +13,11 @@ NavigatorConcurrentHardware::NavigatorConcurrentHardware(
     Navigator& navigator)
     : Supplement<Navigator>(navigator) {}
 
+// VirtualBrowser: Override hardwareConcurrency with fingerprint data
 unsigned NavigatorConcurrentHardware::hardwareConcurrency() const {
+  if (FingerprintGenerator::IsEnabled()) {
+    int cores = FingerprintGenerator::GetHardwareConcurrency();
+    if (cores > 0)
+      return static_cast<unsigned>(cores);
+  }
   return static_cast<unsigned>(base::SysInfo::NumberOfProcessors());
 }
 
diff --git a/third_party/blink/renderer/core/frame/navigator_device_memory.cc b/third_party/blink/renderer/core/frame/navigator_device_memory.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/frame/navigator_device_memory.cc
+++ b/third_party/blink/renderer/core/frame/navigator_device_memory.cc
@@ -4,6 +4,7 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_device_memory.h"
 
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 #include "device/memory_pressure/memory_pressure_voter.h"
 #include "device/memory_pressure/system_memory_pressure_evaluator.h"
 #include "third_party/blink/public/common/device_memory/approximated_device_memory.h"
@@ -27,6 +28,11 @@ NavigatorDeviceMemory::NavigatorDeviceMemory(Navigator& navigator)
 NavigatorDeviceMemory::~NavigatorDeviceMemory() = default;
 
 unsigned NavigatorDeviceMemory::deviceMemory() const {
+  // VirtualBrowser: Override deviceMemory with fingerprint data
+  if (FingerprintGenerator::IsEnabled()) {
+    float memory = FingerprintGenerator::GetDeviceMemory();
+    if (memory > 0)
+      return static_cast<unsigned>(memory);
+  }
   return static_cast<unsigned>(
       ApproximatedDeviceMemory::GetApproximatedDeviceMemory());
 }

diff --git a/third_party/blink/renderer/core/frame/navigator_language.cc b/third_party/blink/renderer/core/frame/navigator_language.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/frame/navigator_language.cc
+++ b/third_party/blink/renderer/core/frame/navigator_language.cc
@@ -4,6 +4,7 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_language.h"
 
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 #include "third_party/blink/renderer/platform/language.h"
 #include "third_party/blink/renderer/platform/wtf/text/wtf_string.h"
 
@@ -17,6 +18,12 @@ NavigatorLanguage::NavigatorLanguage(Navigator& navigator)
 NavigatorLanguage::~NavigatorLanguage() = default;
 
 Vector<String> NavigatorLanguage::languages() {
+  // VirtualBrowser: Override languages with fingerprint data
+  if (FingerprintGenerator::IsEnabled()) {
+    Vector<String> custom_languages = FingerprintGenerator::GetLanguages();
+    if (!custom_languages.IsEmpty())
+      return custom_languages;
+  }
+
   if (languages_.IsEmpty()) {
     languages_.push_back(language());
   }
