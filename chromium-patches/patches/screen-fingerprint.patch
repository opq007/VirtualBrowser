From: VirtualBrowser Team <virtual.browser.2020@gmail.com>
Subject: [PATCH] Screen and Timezone Fingerprint Spoofing
---
This patch modifies screen dimensions, color depth, and timezone settings.

diff --git a/third_party/blink/renderer/core/frame/screen.cc b/third_party/blink/renderer/core/frame/screen.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/frame/screen.cc
+++ b/third_party/blink/renderer/core/frame/screen.cc
@@ -29,6 +29,7 @@
 #include "third_party/blink/renderer/core/frame/screen.h"
 
 #include "third_party/blink/renderer/core/frame/local_frame.h"
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 
 namespace blink {
 
@@ -42,12 +43,24 @@ int Screen::height() const {
   if (!GetFrame())
     return 0;
 
+  // VirtualBrowser: Override screen height
+  if (FingerprintGenerator::IsEnabled()) {
+    int height = FingerprintGenerator::GetScreenHeight();
+    if (height > 0)
+      return height;
+  }
+
   return static_cast<int>(GetFrame()->GetPage()->GetChromeClient().GetScreenInfo(
                               GetFrame())
                               .rect.height);
 }
 
 int Screen::width() const {
+  // VirtualBrowser: Override screen width
+  if (FingerprintGenerator::IsEnabled()) {
+    int width = FingerprintGenerator::GetScreenWidth();
+    if (width > 0)
+      return width;
+  }
+
   if (!GetFrame())
     return 0;
 
@@ -59,6 +72,12 @@ int Screen::width() const {
 unsigned Screen::colorDepth() const {
   if (!GetFrame())
     return 0;
+
+  // VirtualBrowser: Override color depth
+  if (FingerprintGenerator::IsEnabled()) {
+    return static_cast<unsigned>(FingerprintGenerator::GetColorDepth());
+  }
+
   return static_cast<unsigned>(GetFrame()->GetPage()->GetChromeClient().GetScreenInfo(
                                    GetFrame())
                                    .color_depth);
@@ -68,6 +87,11 @@ unsigned Screen::pixelDepth() const {
   if (!GetFrame())
     return 0;
 
+  // VirtualBrowser: Override pixel depth
+  if (FingerprintGenerator::IsEnabled()) {
+    return static_cast<unsigned>(FingerprintGenerator::GetPixelDepth());
+  }
+
   return static_cast<unsigned>(GetFrame()->GetPage()->GetChromeClient().GetScreenInfo(
                                    GetFrame())
                                    .depth);

diff --git a/third_party/blink/renderer/core/execution_context/execution_context.cc b/third_party/blink/renderer/core/execution_context/execution_context.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/core/execution_context/execution_context.cc
+++ b/third_party/blink/renderer/core/execution_context/execution_context.cc
@@ -36,6 +36,7 @@
 #include "third_party/blink/public/mojom/v8_cache_features/v8_cache_features.mojom-blink.h"
 #include "third_party/blink/renderer/bindings/core/v8/source_location.h"
 #include "third_party/blink/renderer/core/dom/events/event_target.h"
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 
 namespace blink {
 
diff --git a/third_party/blink/renderer/platform/timezone_controller.cc b/third_party/blink/renderer/platform/timezone_controller.cc
index 1234567..abcdefg 100644
--- a/third_party/blink/renderer/platform/timezone_controller.cc
+++ b/third_party/blink/renderer/platform/timezone_controller.cc
@@ -4,6 +4,7 @@
 
 #include "third_party/blink/renderer/platform/timezone_controller.h"
 
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 #include "third_party/blink/renderer/platform/instrumentation/histogram.h"
 
 namespace blink {
@@ -25,6 +26,14 @@ const TimeZoneController* TimeZoneController::From(
 // static
 std::string TimeZoneController::GetTimeZoneFor(
     const TimeZoneController* time_zone_controller) {
+
+  // VirtualBrowser: Override timezone
+  if (FingerprintGenerator::IsEnabled()) {
+    String tz = FingerprintGenerator::GetTimezone();
+    if (!tz.IsEmpty())
+      return tz.Ascii();
+  }
+
   if (!time_zone_controller)
     return base::DefaultTimeZoneId();
 
diff --git a/v8/src/objects/js-date-time-format.cc b/v8/src/objects/js-date-time-format.cc
index 1234567..abcdefg 100644
--- a/v8/src/objects/js-date-time-format.cc
+++ b/v8/src/objects/js-date-time-format.cc
@@ -21,6 +21,7 @@
 #include "src/objects/managed-inl.h"
 #include "src/objects/objects-inl.h"
 #include "src/objects/option-utils.h"
+#include "third_party/blink/renderer/core/fingerprint/fingerprint_generator.h"
 
 namespace v8 {
 namespace internal {
